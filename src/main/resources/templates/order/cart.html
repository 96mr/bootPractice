<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
    <th:block layout:fragment="css">
		<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet"> 
	</th:block>
	<th:block layout:fragment ="script">
		<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
		<script src=" https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/lang/summernote-ko-KR.min.js"></script>
	</th:block>
<div layout:fragment="content">
	<div class="container w-50 text-center p-2 bg-white">
		<div class="row"> 
			<div class="col-md-6 p-2">
				<img id="product-info-img" th:src="'/bootPractice/attach/'+ ${info.thumbnail[0].save_name} + ${info.thumbnail[0].extension}" class="img-fluid"/>
			</div>
			<div class="col-md-6">
				<form id="order-form" class="p-2 mx-auto justify-content-center row">
					<input type="hidden" name="num" th:value="${num}"/>
					<span th:text="${product}">제품명</span>
					<div class="product-count">
						<button type="button" class="btn btn-outline-light" name="up" value="-"></button>
							<input type="number" class="form-control" name="count" value="1"/>
						<button type="button" class="btn btn-outline-light" name="down" value="+"></button>
					</div>
					<button type="button" name="cart-btn" class="btn btn-outline-dark btn-block w-20 mx-auto">삭제</button>
					<button type="button" name="order-btn" class="btn btn-outline-dark btn-block w-50 mx-auto">구매하기</button>
				</form>
			</div>
			<!-- 모달 추가할 것 -->
		</div>
		<hr>
	</div>
	<script th:inline="javascript">
		$(document).ready(function(){
			var msg = [[${errorMsg}]];
			if(msg) {
				alert(msg);
			}
		});
	</script>
	<script>
		$('#summernote').summernote({
	        placeholder: '제품에 대한 설명을 작성해주세요',
	        tabsize: 2,
	        height: 500,
	        lang: 'ko-KR',
	        toolar:[
	        	['style',['style']],
	        	['font', ['bold', 'underline','clear']],
	        	['color',['color']],
	        	['table',['table']],
	        	['insert',['link','picture','video']]
	        ],
	        callbacks : { 
	        	//이미지 업로드
	            onImageUpload : function(files, editor, welEditable) {
	            	for (var i = files.length - 1; i >= 0; i--) {
	            		uploadImageFile(files[i], this);
	            		console.log(file[i]);
	            	}
	            },
				onPaste : function(e){
					var data = e.originalEvent.clipboardData;
					if(data && data.items && data.items.length){
						var item = data.items[0];
						if(item.kind === 'file' && item.type.indexOf('image/') !== -1){
							e.preventDefault();
						}
					}		
				}
	         }
	      });
		
		 function uploadImageFile(file, el) {
				data = new FormData();
				data.append("file", file);
				$.ajax({
					data : data,
					type : "POST",
					url : "/product/uploadImage",
					contentType : false,
					enctype : 'multipart/form-data',
					processData : false,
					success : function(data) {
						$(el).summernote('editor.insertImage', data.url);
						console.log(data);
					}
				});
			}
		 
		 let thumbnailFile = document.querySelector("#thumbnail"); 
		 let img = document.querySelector("#previewImage img");
		 
		 thumbnailFile.addEventListener('change', () => {
			 
			 if(thumbnailFile.files.length > 0){ // 파일 여부를 확인
				 let reader = new FileReader();
				 
			 	reader.onload = function(data){
			 		console.log(data);
			 		img.src = data.target.result;
			 	}
			 	reader.readAsDataURL(thumbnailFile.files[0]);
			 }else{
				 img.src = "";
			 }
		 });
	</script>
</div>
</html>